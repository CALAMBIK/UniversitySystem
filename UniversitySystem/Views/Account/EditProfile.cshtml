@model UniversitySystem.Models.UserProfile
@{
    ViewData["Title"] = "Редактирование профиля";
}

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">
                        Редактирование профиля
                    </h3>
                </div>
                <div class="card-body">
                    @if (TempData["ErrorMessage"] != null)
                    {
                        <div class="alert alert-danger">
                            @TempData["ErrorMessage"]
                        </div>
                    }

                    @if (TempData["SuccessMessage"] != null)
                    {
                        <div class="alert alert-success">
                            @TempData["SuccessMessage"]
                        </div>
                    }

                    <form method="post">
                        @Html.AntiForgeryToken()

                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="text-primary">
                                    Основная информация
                                </h5>
                                <hr>
                            </div>
                        </div>

                        <div class="row">
                            @if (ViewBag.UserRole == "Student" && ViewBag.User?.Student != null)
                            {
                                var student = ViewBag.User.Student as UniversitySystem.Models.Student;
                                <div class="col-md-6 mb-3">
                                    <label for="secondName" class="form-label">Фамилия *</label>
                                    <input type="text" class="form-control" id="secondName" name="secondName"
                                           value="@student.SecondName" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="name" class="form-label">Имя *</label>
                                    <input type="text" class="form-control" id="name" name="name"
                                           value="@student.Name" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="patronymic" class="form-label">Отчество</label>
                                    <input type="text" class="form-control" id="patronymic" name="patronymic"
                                           value="@student.Patronymic">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="phoneNumber" class="form-label">Телефон</label>
                                    <input type="tel" class="form-control" id="phoneNumber" name="phoneNumber"
                                           value="@student.PhoneNumber">
                                </div>
                            }
                            else if (ViewBag.UserRole == "Teacher" && ViewBag.User?.Teacher != null)
                            {
                                var teacher = ViewBag.User.Teacher as UniversitySystem.Models.Teacher;
                                <div class="col-md-6 mb-3">
                                    <label for="secondName" class="form-label">Фамилия *</label>
                                    <input type="text" class="form-control" id="secondName" name="secondName"
                                           value="@teacher.SecondName" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="name" class="form-label">Имя *</label>
                                    <input type="text" class="form-control" id="name" name="name"
                                           value="@teacher.Name" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="patronymic" class="form-label">Отчество</label>
                                    <input type="text" class="form-control" id="patronymic" name="patronymic"
                                           value="@teacher.Patronymic">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="phoneNumber" class="form-label">Телефон</label>
                                    <input type="tel" class="form-control" id="phoneNumber" name="phoneNumber"
                                           value="@teacher.PhoneNumber">
                                </div>
                            }
                            else if (ViewBag.UserRole == "Admin")
                            {
                                <div class="col-12 mb-3">
                                    <div class="alert alert-info">
                                        <strong>Информация:</strong> Для администраторов доступно только редактирование контактной информации.
                                    </div>
                                </div>
                            }
                        </div>

                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="text-primary">
                                     Контактная информация
                                </h5>
                                <hr>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="Email" class="form-label">Email</label>
                                <input asp-for="Email" class="form-control" type="email"
                                       placeholder="Введите ваш email">
                                <span asp-validation-for="Email" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="Phone" class="form-label">Дополнительный телефон</label>
                                <input asp-for="Phone" class="form-control"
                                       placeholder="Введите дополнительный телефон">
                                <span asp-validation-for="Phone" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                    <a href="@Url.Action("Profile", "Account")" class="btn btn-secondary me-md-2">
                                         Назад к профилю
                                    </a>
                                    <button type="submit" class="btn btn-primary">
                                         Сохранить изменения
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-warning text-dark">
                            <h6 class="mb-0"> Безопасность</h6>
                        </div>
                        <div class="card-body">
                            <a href="@Url.Action("ChangePassword", "Account")" class="btn btn-outline-warning btn-sm">
                                 Сменить пароль
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-info text-white">
                            <h6 class="mb-0"> Профиль</h6>
                        </div>
                        <div class="card-body">
                            <a href="@Url.Action("Profile", "Account")" class="btn btn-outline-info btn-sm">
                                 Просмотр профиля
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        setTimeout(function() {
            $('.alert').fadeOut('slow');
        }, 5000);

        $(document).ready(function() {
            $('form').on('submit', function(e) {
                let isValid = true;

                $('input[required]').each(function() {
                    if ($(this).val().trim() === '') {
                        $(this).addClass('is-invalid');
                        isValid = false;
                    } else {
                        $(this).removeClass('is-invalid');
                    }
                });

                if (!isValid) {
                    e.preventDefault();
                    alert('Пожалуйста, заполните все обязательные поля (отмечены *).');
                }
            });

            $('input[required]').on('input', function() {
                if ($(this).val().trim() !== '') {
                    $(this).removeClass('is-invalid');
                }
            });
        });
    </script>
}